<!-- docs/architecture.svg -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 520" width="100%" role="img" aria-label="PicoPics architecture diagram">
  <defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="6" stdDeviation="10" flood-opacity="0.15" />
    </filter>
    <style>
      .box { rx:10; ry:10; stroke:#222; stroke-width:1; filter:url(#shadow); }
      .title { font: 700 18px/1.1 Inter, Arial, sans-serif; fill:#0f172a }
      .label { font: 600 13px/1 Inter, Arial, sans-serif; fill:#0f172a }
      .desc { font: 400 12px/1 Inter, Arial, sans-serif; fill:#334155 }
      .arrow { stroke:#94a3b8; stroke-width:2; fill:none; marker-end:url(#arrowhead); }
    </style>
    <marker id="arrowhead" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"/>
    </marker>
  </defs>

  <!-- Top row: Frontend -->
  <g transform="translate(40,20)">
    <rect class="box" width="260" height="80" fill="#e6f0ff" />
    <text class="title" x="18" y="32">Next.js Frontend</text>
    <text class="desc" x="18" y="52">User interface — upload, browse, manage</text>
  </g>

  <!-- Uploader Worker -->
  <g transform="translate(380,20)">
    <rect class="box" width="260" height="100" fill="#e9e7ff" />
    <text class="title" x="18" y="32">Uploader Worker</text>
    <text class="desc" x="18" y="52">Authentication • Pre-checks • Chunked upload</text>
    <text class="desc" x="18" y="70">Triggers AI moderation and storage write</text>
  </g>

  <!-- AI & Quota -->
  <g transform="translate(720,20)">
    <rect class="box" width="240" height="120" fill="#fff7ed" />
    <text class="title" x="18" y="32">Cloudflare AI</text>
    <text class="desc" x="18" y="52">Image analysis & moderation</text>
    <rect x="18" y="62" width="204" height="1" fill="#e6e7eb" />
    <text class="label" x="18" y="86">Durable Objects</text>
    <text class="desc" x="18" y="102">Quota, rate limit & abuse state</text>
  </g>

  <!-- Storage (R2) center -->
  <g transform="translate(360,180)">
    <rect class="box" width="280" height="110" fill="#fff0d6" />
    <text class="title" x="20" y="44">R2 Storage</text>
    <text class="desc" x="20" y="66">Objects: original, optimized, thumbnails</text>
    <text class="desc" x="20" y="86">HTTP metadata and lifecycle rules</text>
  </g>

  <!-- Delivery Worker -->
  <g transform="translate(40,340)">
    <rect class="box" width="260" height="100" fill="#e6fff5" />
    <text class="title" x="18" y="34">CDN Delivery Worker</text>
    <text class="desc" x="18" y="58">Edge-optimized response • caching rules • transforms</text>
  </g>

  <!-- End User -->
  <g transform="translate(720,340)">
    <rect class="box" width="240" height="100" fill="#e9f5ff" />
    <text class="title" x="18" y="34">End User</text>
    <text class="desc" x="18" y="58">Browser or client requesting images</text>
  </g>

  <!-- Arrows: Frontend -> Uploader -->
  <path class="arrow" d="M300 60 L380 60" />
  <text class="label" x="330" y="50">POST /upload</text>

  <!-- Uploader -> AI -->
  <path class="arrow" d="M640 60 L720 60" />
  <text class="label" x="650" y="50">scan(image)</text>

  <!-- Uploader -> R2 -->
  <path class="arrow" d="M500 120 L500 180" />
  <text class="label" x="420" y="150">write object</text>

  <!-- AI -> R2 (approve) -->
  <path class="arrow" d="M840 120 L640 240" />
  <text class="label" x="730" y="160">approved → store</text>

  <!-- R2 -> CDN Worker -->
  <path class="arrow" d="M420 290 L200 380" />
  <text class="label" x="300" y="340">GET /image/:id</text>

  <!-- CDN -> End User -->
  <path class="arrow" d="M560 290 L720 380" />
  <text class="label" x="620" y="340">edge cache → client</text>

  <!-- Durable Objects interactions (dashed) -->
  <path stroke="#94a3b8" stroke-width="1.5" stroke-dasharray="6 6" fill="none" d="M560 80 L720 130" />
  <text class="desc" x="580" y="100">quota/check</text>

  <!-- Legend -->
  <g transform="translate(40,460)">
    <text class="label" x="0" y="14">Legend</text>
    <rect x="0" y="22" width="12" height="12" fill="#e6f0ff" stroke="#222"/>
    <text class="desc" x="20" y="32">Frontend</text>
    <rect x="140" y="22" width="12" height="12" fill="#e9e7ff" stroke="#222"/>
    <text class="desc" x="160" y="32">Worker (compute)</text>
    <rect x="320" y="22" width="12" height="12" fill="#fff0d6" stroke="#222"/>
    <text class="desc" x="340" y="32">Storage</text>
    <rect x="520" y="22" width="12" height="12" fill="#e6fff5" stroke="#222"/>
    <text class="desc" x="540" y="32">Delivery</text>
  </g>
</svg>